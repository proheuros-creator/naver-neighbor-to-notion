# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§­ Naver BlogHome â†’ Notion ìë™ ìŠ¤í¬ë© ì›Œí¬í”Œë¡œìš°
#
# âœ… ì£¼ìš” ê¸°ëŠ¥:
#   //- ë§¤ì¼ í•œêµ­ì‹œê°„ ìƒˆë²½ 3ì‹œì— ìë™ ì‹¤í–‰
#   - ë˜ëŠ” GitHub Actions â†’ "Run workflow" ë²„íŠ¼ìœ¼ë¡œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
#   - Node.js í™˜ê²½ì—ì„œ index.js ì‹¤í–‰ â†’ notion.jsì™€ ì—°ë™
#   - concurrency ì„¤ì •ìœ¼ë¡œ ìŠ¤í¬ë© ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
#
# âš™ï¸ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­:
#   1. GitHub Secretsì— ì•„ë˜ í™˜ê²½ë³€ìˆ˜ ë“±ë¡
#      - NAVER_COOKIE           â†’ ë„¤ì´ë²„ ë¡œê·¸ì¸ ì„¸ì…˜ ì¿ í‚¤ (JSESSIONID í¬í•¨)
#      - NAVER_NEIGHBOR_API_URL â†’ BuddyPostList API URL (ì˜ˆ: https://section.blog.naver.com/ajax/BuddyPostList.naver?page=1&groupId=0)
#      - NOTION_API_KEY         â†’ Notion í†µí•©(Integration) API í‚¤
#      - NOTION_DATABASE_ID     â†’ Notion ë°ì´í„°ë² ì´ìŠ¤ ID
#   2. package.jsonì— "start": "node index.js" ì„¤ì • í•„ìš”
#   3. notion.js, index.js íŒŒì¼ì´ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìˆì–´ì•¼ í•¨
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

name: Naver BlogHome to Notion (30pages)  # ì›Œí¬í”Œë¡œìš° ì´ë¦„

on:
  //# â° (1) ìŠ¤ì¼€ì¤„ ê¸°ë°˜ ì‹¤í–‰
  //schedule:
  //  # ë§¤ì¼ UTC 18:00 (í•œêµ­ì‹œê°„ ìƒˆë²½ 3ì‹œ)
  //  - cron: '0 18 * * *'

  # ğŸ– (2) ìˆ˜ë™ ì‹¤í–‰ (GitHub Actions > Run workflow ë²„íŠ¼)
  workflow_dispatch: {}

jobs:
  scrape:
    runs-on: ubuntu-latest
    timeout-minutes: 720  # (ì„ íƒ) ìµœëŒ€ ì‹¤í–‰ì‹œê°„ ì œí•œ

    # ğŸš§ concurrency ì„¤ì • (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
    concurrency:
      group: notion-scripts
      cancel-in-progress: false
      # ì„¤ëª…:
      # - group: ë™ì¼ ê·¸ë£¹ ë‚´ì—ì„œëŠ” ë™ì‹œì— í•œ ê°œë§Œ ì‹¤í–‰ ê°€ëŠ¥
      # - cancel-in-progress: false â†’ ê¸°ì¡´ ì‹¤í–‰ ì¤‘ì¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ìœ ì§€í•˜ê³ , ìƒˆ ì‹¤í–‰ì€ ëŒ€ê¸°í•¨
      #   (trueë¡œ ë°”ê¾¸ë©´ ìƒˆ ì‹¤í–‰ ì‹œ ê¸°ì¡´ ì‹¤í–‰ì€ ìë™ ì·¨ì†Œë¨)

    # ğŸ§© Node.js ì•±ì—ì„œ ì‚¬ìš©í•  í™˜ê²½ë³€ìˆ˜ ì„¤ì •
    env:
      NAVER_COOKIE: ${{ secrets.NAVER_COOKIE }}
      NAVER_NEIGHBOR_API_URL: ${{ secrets.NAVER_NEIGHBOR_API_URL }}
      NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
      NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
      MAX_PAGE: 10  # ìŠ¤í¬ë©í•  ë§ˆì§€ë§‰ í˜ì´ì§€ (150 â†’ 1 ìˆœìœ¼ë¡œ ìˆ˜ì§‘)

    steps:
      # 1ï¸âƒ£ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Node.js ì„¤ì¹˜
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3ï¸âƒ£ ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: npm install

      # 4ï¸âƒ£ ìŠ¤í¬ë˜í¼ ì‹¤í–‰
      - name: Run scraper
        run: npm start

      # (ì„ íƒ) 5ï¸âƒ£ ì‹¤í–‰ ê²°ê³¼ ì¶œë ¥
      - name: Print workflow summary
        if: always()
        run: |
          echo "ğŸ“Š ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì™„ë£Œ ì‹œê°„: $(date)"
          echo "âš™ï¸  ìµœëŒ€ í˜ì´ì§€: $MAX_PAGE"
          echo "ğŸ”’ concurrency group: notion-scripts (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ í™œì„±í™”)"
